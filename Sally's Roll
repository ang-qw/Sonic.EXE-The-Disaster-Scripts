local player = game.Players.LocalPlayer

if game.PlaceId == 14722542056 then
    local displayPlayers = game:GetService("ReplicatedStorage"):WaitForChild("displayPlayers")
    local playerStats = displayPlayers:FindFirstChild(player.Name):WaitForChild("stats")
    local characterValue = playerStats:WaitForChild("character")
    
    -- Solo se permite para el personaje "sally"
    local allowedCharacters = {
        ["sally"] = true
    }
    
    local function canUseRoll()
        return allowedCharacters[characterValue.Value:lower()] or false
    end
    
    -- Verifica que el personaje est√© en el suelo (no en el aire)
    local function isOnGround()
        local character = player.Character
        if not character or not character:FindFirstChild("HumanoidRootPart") then return false end
        local ray = Ray.new(character.HumanoidRootPart.Position, Vector3.new(0, -4, 0))
        local hit = workspace:FindPartOnRay(ray, character)
        return hit and hit:IsDescendantOf(workspace)
    end
    
    local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    gui.Name = "RollGUI"
    
    local container = Instance.new("Frame")
    container.Size = UDim2.new(0, 60, 0, 60)
    container.Position = UDim2.new(1, -80, 0.5, -30)
    container.BackgroundTransparency = 1
    container.Parent = gui
    container.ZIndex = 100
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0, 60, 0, 20)
    titleLabel.Position = UDim2.new(0, 0, -0.4, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Roll"
    titleLabel.TextScaled = true
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.FontFace = Font.new("rbxassetid://12187371840", Enum.FontWeight.Bold, Enum.FontStyle.Normal)
    titleLabel.TextStrokeTransparency = 0
    titleLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    titleLabel.Parent = container
    titleLabel.ZIndex = 105
    
    local shadowStain = Instance.new("Frame")
    shadowStain.Size = UDim2.new(1, 10, 1, 10)
    shadowStain.Position = UDim2.new(0, -5, 0, -5)
    shadowStain.BackgroundColor3 = Color3.new(0, 0, 0)
    shadowStain.BackgroundTransparency = 1
    shadowStain.Parent = container
    
    local stainGradient = Instance.new("UIGradient", shadowStain)
    stainGradient.Rotation = 45
    stainGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.new(0, 0, 0)),
        ColorSequenceKeypoint.new(1, Color3.new(0, 0, 0))
    })
    stainGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0.3),
        NumberSequenceKeypoint.new(1, 1)
    })
    
    local outerBorder = Instance.new("Frame")
    outerBorder.Size = UDim2.new(1, 0, 1, 0)
    outerBorder.Position = UDim2.new(0, 0, 0, 0)
    outerBorder.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
    outerBorder.Parent = container
    outerBorder.ZIndex = 101
    
    local outerCorner = Instance.new("UICorner", outerBorder)
    outerCorner.CornerRadius = UDim.new(1, 0)
    
    local outerGradient = Instance.new("UIGradient", outerBorder)
    outerGradient.Rotation = 90
    outerGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(139, 0, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(170, 0, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(139, 0, 0))
    })
    outerGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(0.5, 0),
        NumberSequenceKeypoint.new(1, 0)
    })
    
    local innerBorder = Instance.new("Frame")
    innerBorder.Size = UDim2.new(1, -8, 1, -8)
    innerBorder.Position = UDim2.new(0, 4, 0, 4)
    innerBorder.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    innerBorder.Parent = outerBorder
    innerBorder.ZIndex = 102
    
    local innerCorner = Instance.new("UICorner", innerBorder)
    innerCorner.CornerRadius = UDim.new(1, 0)
    
    local innerGradient = Instance.new("UIGradient", innerBorder)
    innerGradient.Rotation = 90
    innerGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 50, 50)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 100, 100)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 50, 50))
    })
    innerGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(0.5, 0),
        NumberSequenceKeypoint.new(1, 0)
    })
    
    local effectFrame = Instance.new("Frame")
    effectFrame.Size = UDim2.new(1, -6, 1, -6)
    effectFrame.Position = UDim2.new(0, 3, 0, 3)
    effectFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    effectFrame.Parent = innerBorder
    effectFrame.ZIndex = 103
    
    local effectCorner = Instance.new("UICorner", effectFrame)
    effectCorner.CornerRadius = UDim.new(1, 0)
    
    local effectFrameGradient = Instance.new("UIGradient", effectFrame)
    effectFrameGradient.Rotation = 90
    effectFrameGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
    })
    effectFrameGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(1, 0)
    })
    
    local shadowAsset = Instance.new("ImageLabel")
    shadowAsset.Size = UDim2.new(1, 10, 1, 10)
    shadowAsset.Position = UDim2.new(0, -5, 0, -5)
    shadowAsset.BackgroundTransparency = 1
    shadowAsset.Image = "rbxassetid://114739599325115"
    shadowAsset.ImageTransparency = 0.1
    shadowAsset.Parent = effectFrame
    shadowAsset.ZIndex = 102
    
    local shadowAssetGradient = Instance.new("UIGradient", shadowAsset)
    shadowAssetGradient.Rotation = 90
    shadowAssetGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 220, 220)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 220, 220))
    })
    shadowAssetGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(1, 0)
    })
    
    local iconLabel = Instance.new("ImageLabel")
    iconLabel.Size = UDim2.new(1, 0, 1, 0)
    iconLabel.Position = UDim2.new(0, 0, 0, 0)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Image = "rbxassetid://12332311481"  -- Nuevo icono para Roll
    iconLabel.ImageColor3 = Color3.fromRGB(255, 255, 255)
    iconLabel.Parent = effectFrame
    iconLabel.ZIndex = 103
    
    local iconGradient = Instance.new("UIGradient", iconLabel)
    iconGradient.Rotation = 90
    iconGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(150, 150, 150)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
    })
    iconGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(1, 0.55)
    })
    
    local cooldownText = Instance.new("TextLabel")
    cooldownText.Size = UDim2.new(0, 30, 0, 30)
    cooldownText.Position = UDim2.new(0.5, -15, 0.5, -15)
    cooldownText.BackgroundTransparency = 1
    cooldownText.TextScaled = true
    cooldownText.FontFace = Font.new("rbxassetid://12187371840", Enum.FontWeight.Bold, Enum.FontStyle.Normal)
    cooldownText.TextColor3 = Color3.new(1, 1, 1)
    cooldownText.Visible = false
    cooldownText.Parent = container
    cooldownText.ZIndex = 104
    
    local rollButtonOverlay = Instance.new("ImageButton")
    rollButtonOverlay.Size = UDim2.new(1, 0, 1, 0)
    rollButtonOverlay.Position = UDim2.new(0, 0, 0, 0)
    rollButtonOverlay.BackgroundTransparency = 1
    rollButtonOverlay.Parent = container
    rollButtonOverlay.Draggable = true
    rollButtonOverlay.Active = true
    rollButtonOverlay.Visible = canUseRoll()
    rollButtonOverlay.ZIndex = 105
    
    local cooldownActive = false
    
    local function activateRoll()
        if cooldownActive or not isOnGround() or not canUseRoll() then return end
        
        cooldownActive = true
        cooldownText.Visible = true
        -- Se activa un efecto de gradiente rojo para el cooldown
        effectFrameGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
        })
        iconGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
        })
        
        effectFrame.BackgroundTransparency = 0.5
        iconLabel.ImageColor3 = Color3.fromRGB(255, 255, 255)
        iconGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
        })
        
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoid = character:WaitForChild("Humanoid")
        local animation = Instance.new("Animation")
        animation.AnimationId = "rbxassetid://16264988703"
        local animTrack = humanoid:LoadAnimation(animation)
        animTrack:Play()
        
        task.delay(0.32, function()
            local boostForce = 52
            local boostDuration = 0.62
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
            local bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.MaxForce = Vector3.new(1000000, 0, 1000000)
            bodyVelocity.Parent = humanoidRootPart
            
            local startTime = tick()
            while tick() - startTime < boostDuration do
                if not isOnGround() then break end
                bodyVelocity.Velocity = humanoidRootPart.CFrame.LookVector * boostForce
                wait(0)
            end
            bodyVelocity:Destroy()
        end)
        
        -- Contador de cooldown de 17 segundos
        for i = 17, 1, -1 do
            cooldownText.Text = tostring(i)
            task.wait(1)
        end
        cooldownText.Visible = false
        cooldownActive = false
        
        -- Se restablecen los gradientes originales
        effectFrameGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
        })
        iconGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(150, 150, 150)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
        })
    end
    
    rollButtonOverlay.MouseButton1Click:Connect(activateRoll)
    
    local userInput = game:GetService("UserInputService")
    userInput.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Enum.KeyCode.P then
            activateRoll()
        end
    end)
    
    characterValue.Changed:Connect(function()
        rollButtonOverlay.Visible = canUseRoll()
    end)
end
